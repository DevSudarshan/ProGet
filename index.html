
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Bike Care & Travel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
:root{
--dark-bg:#0b0b12;
--dark-card:#151523;
--light-bg:#f4f7fa;
--primary:#7c4dff;
--text-dark:#e0e0ff;
--text-light:#1a2a44;
}
body{font-family:Montserrat;background:var(--dark-bg);color:var(--text-dark)}
.light-mode{background:var(--light-bg);color:var(--text-light)}
.navbar{background:#0b0b12}
.card{background:var(--dark-card);border-radius:16px}
.light-mode .card{background:#ffffff;color:#1a2a44}
.btn-premium{background:linear-gradient(135deg,#7c4dff,#512da8);color:#fff;border-radius:50px;padding:10px 22px}
#map{height:420px;border-radius:20px}
</style>
</head>

<body>
<nav class="navbar navbar-dark px-3">
<span class="navbar-brand">ğŸ Bike Care</span>
<div>
<button class="btn btn-sm btn-premium me-2" onclick="toggleTheme()">ğŸŒ™ / â˜€ï¸</button>
<a href="parts.html" class="btn btn-sm btn-premium">Parts</a>
</div>
</nav>

<div class="container py-4">
<h4>ğŸ“ Map</h4>
<div id="map"></div>

<input id="destination" class="form-control mt-3" placeholder="Enter destination">
<button class="btn btn-premium mt-2" onclick="route()">ğŸ§­ Route</button>
<button class="btn btn-premium mt-2 ms-2" onclick="saveTrip()">ğŸ’¾ Save Trip</button>
<button class="btn btn-premium mt-2 ms-2" onclick="findFuel()">â›½ Nearest Fuel</button>

<h5 class="mt-3">Saved Trips</h5>
<ul id="tripList"></ul>
</div>

<div class="container py-4">
<h4>ğŸ Mileage Tracker</h4>
<input id="fuel" class="form-control mb-2" placeholder="Fuel Filled (litres)">
<input id="distance" class="form-control mb-2" placeholder="Distance Covered (km)">
<button class="btn btn-premium" onclick="calcMileage()">Calculate</button>
<p id="mileageResult" class="mt-2"></p>
</div>

<div class="container py-4">
<h4>ğŸ”§ Service Tracker</h4>
<input id="lastService" class="form-control mb-2" placeholder="Last Service KM">
<input id="currentKm" class="form-control mb-2" placeholder="Current KM">
<button class="btn btn-premium" onclick="checkService()">Check Service</button>
<p id="serviceResult" class="mt-2"></p>
</div>

<div class="container py-4">
<h4>ğŸš˜ Vehicle Information (RTO)</h4>

<input id="vehicleNo" class="form-control mb-2"
placeholder="Enter Vehicle Number (e.g. MH12AB1234)">

<button class="btn btn-premium" onclick="openRTO()">
Check Vehicle Details
</button>
</div>


<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
let map,userLoc,routeLine;

navigator.geolocation.getCurrentPosition(p=>{
userLoc=[p.coords.latitude,p.coords.longitude];
map=L.map('map').setView(userLoc,14);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
L.marker(userLoc).addTo(map).bindPopup("You are here").openPopup();
loadTrips();
});

function route(){
fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${destination.value}`)
.then(r=>r.json()).then(d=>{
let dest=[d[0].lat,d[0].lon];
if(routeLine) map.removeLayer(routeLine);
routeLine=L.polyline([userLoc,dest],{color:'#7c4dff'}).addTo(map);
map.fitBounds(routeLine.getBounds());
});
}

function routeFromSaved(placeName){
    fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(placeName)}`)
    .then(res => res.json())
    .then(data => {
        if(!data.length) return alert("Location not found");

        let dest = [data[0].lat, data[0].lon];

        if(routeLine) map.removeLayer(routeLine);

        routeLine = L.polyline([userLoc, dest], {
            color: "#7c4dff",
            weight: 5
        }).addTo(map);

        map.fitBounds(routeLine.getBounds());
    });
}


function saveTrip(){
    const dest = destination.value.trim();
    if(!dest) return alert("Enter destination");

    let trips = JSON.parse(localStorage.getItem("trips") || "[]");

    // Prevent duplicate
    if(trips.includes(dest)){
        return alert("This destination is already saved");
    }

    // Limit to 6 trips
    if(trips.length >= 6){
        return alert("You can save only 6 trips");
    }

    trips.push(dest);
    localStorage.setItem("trips", JSON.stringify(trips));
    loadTrips();
}



function loadTrips(){
    let trips = JSON.parse(localStorage.getItem("trips") || "[]");
    tripList.innerHTML = "";

    trips.forEach((t, index) => {
        let li = document.createElement("li");
        li.style.display = "flex";
        li.style.justifyContent = "space-between";
        li.style.alignItems = "center";
        li.style.cursor = "pointer";
        li.style.marginBottom = "8px";

        // Trip name (click = route)
        let name = document.createElement("span");
        name.innerText = "ğŸ“ " + t;
        name.onclick = () => routeFromSaved(t);

        // Delete button
        let del = document.createElement("span");
        del.innerText = "âŒ";
        del.style.cursor = "pointer";
        del.onclick = () => deleteTrip(index);

        li.appendChild(name);
        li.appendChild(del);
        tripList.appendChild(li);
    });
}

function deleteTrip(index){
    let trips = JSON.parse(localStorage.getItem("trips") || "[]");
    trips.splice(index, 1);
    localStorage.setItem("trips", JSON.stringify(trips));
    loadTrips();
}


function findFuel(){
fetch(`https://overpass-api.de/api/interpreter?data=[out:json];node(around:5000,${userLoc[0]},${userLoc[1]})[amenity=fuel];out;`)
.then(r=>r.json()).then(d=>{
let nearest=d.elements[0],min=Infinity;
d.elements.forEach(p=>{
let dist=map.distance(userLoc,[p.lat,p.lon]);
if(dist<min){min=dist;nearest=p;}
});
L.marker([nearest.lat,nearest.lon]).addTo(map)
.bindPopup("â›½ Nearest fuel "+(min/1000).toFixed(2)+" km").openPopup();
});
}

function calcMileage(){
let f=parseFloat(fuel.value);
let d=parseFloat(distance.value);
if(!f||!d) return;
mileageResult.innerText="Mileage: "+(d/f).toFixed(2)+" km/l";
}

function checkService(){
let l=parseInt(lastService.value);
let c=parseInt(currentKm.value);
serviceResult.innerText=(c-l)>=3000?"âš ï¸ Service Due":"âœ… Service OK";
}


function openRTO(){
    const v = document.getElementById("vehicleNo").value;
    if(!v) return alert("Enter vehicle number");

    window.open(
        "https://vahan.parivahan.gov.in/vahanservice/vahan/ui/statevalidation/homepage.xhtml",
        "_blank"
    );
}

function toggleTheme(){
document.body.classList.toggle("light-mode");
}
</script>
</body>
</html>
