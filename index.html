<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bike Care & Travel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css"/>

<style>
:root{
--dark-bg:#0b0b12;
--dark-card:#151523;
--light-bg:#f4f7fa;
--primary:#7c4dff;
--text-dark:#e0e0ff;
--text-light:#1a2a44;
}
body{font-family:Montserrat;background:var(--dark-bg);color:var(--text-dark)}
.light-mode{background:var(--light-bg);color:var(--text-light)}
.navbar{background:#0b0b12}
.card{background:var(--dark-card);border-radius:16px;padding:15px}
.light-mode .card{background:#fff;color:#1a2a44}
.btn-premium{background:linear-gradient(135deg,#7c4dff,#512da8);color:#fff;border-radius:50px;padding:10px 22px;border:none}
#map{height:420px;border-radius:20px}
li{list-style:none;margin-bottom:6px}
</style>
</head>

<body>

<nav class="navbar navbar-dark px-3">
<span class="navbar-brand">ğŸ Bike Care</span>
<button class="btn btn-sm btn-premium" onclick="toggleTheme()">ğŸŒ™ / â˜€ï¸</button>
</nav>

<div class="container py-4">
<h4>ğŸ“ Map</h4>
<div id="map"></div>

<!-- Turn by turn panel -->
<div class="card mt-3">
<h5>ğŸ§­ Turn-by-Turn Directions</h5>
<div id="directions" style="max-height:200px; overflow-y:auto;"></div>
<p class="mt-2"><strong>ETA:</strong> <span id="eta">--</span></p>
<p><strong>Distance:</strong> <span id="distanceInfo">--</span></p>
</div>

<input id="destination" class="form-control mt-3" placeholder="Enter destination">
<button class="btn btn-premium mt-2" onclick="route()">ğŸ§­ Route</button>
<button class="btn btn-premium mt-2 ms-2" onclick="saveTrip()">ğŸ’¾ Save Trip</button>
<button class="btn btn-premium mt-2 ms-2" onclick="findFuel()">â›½ Nearest Fuel</button>

<h5 class="mt-3">Saved Trips (max 6)</h5>
<ul id="tripList"></ul>
</div>

<div class="container py-4">
<h4>ğŸ Mileage Tracker</h4>
<input id="fuel" class="form-control mb-2" placeholder="Fuel Filled (litres)">
<input id="distance" class="form-control mb-2" placeholder="Distance Covered (km)">
<button class="btn btn-premium" onclick="calcMileage()">Calculate</button>
<p id="mileageResult"></p>
</div>

<div class="container py-4">
<h4>ğŸ”§ Service Tracker</h4>
<input id="lastService" class="form-control mb-2" placeholder="Last Service KM">
<input id="currentKm" class="form-control mb-2" placeholder="Current KM">
<button class="btn btn-premium" onclick="checkService()">Check</button>
<p id="serviceResult"></p>
</div>

<div class="container py-4">
<h4>ğŸš˜ Vehicle Information (RTO)</h4>
<input id="vehicleNo" class="form-control mb-2" placeholder="MH12AB1234">
<button class="btn btn-premium" onclick="openRTO()">Check Vehicle</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

<script>
let map, userLoc, routingControl;

// Init map
navigator.geolocation.getCurrentPosition(p=>{
    userLoc=[p.coords.latitude,p.coords.longitude];
    map=L.map('map').setView(userLoc,14);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    L.marker(userLoc).addTo(map).bindPopup("You are here").openPopup();
    loadTrips();
});

// Routing with turn-by-turn + ETA
function routeFromTo(start,end){
    if(routingControl) map.removeControl(routingControl);

    routingControl=L.Routing.control({
        waypoints:[L.latLng(start),L.latLng(end)],
        addWaypoints:false,
        draggableWaypoints:false,
        routeWhileDragging:false,
        show:false,
        createMarker:()=>null,
        lineOptions:{styles:[{color:'#7c4dff',weight:6}]}
    })
    .on('routesfound',e=>{
        const r=e.routes[0];
        document.getElementById("eta").innerText =
            Math.round(r.summary.totalTime/60)+" mins";
        document.getElementById("distanceInfo").innerText =
            (r.summary.totalDistance/1000).toFixed(2)+" km";

        let html="";
        r.instructions.forEach(i=>{
            html+=`<div>â¡ï¸ ${i.text}</div>`;
        });
        document.getElementById("directions").innerHTML=html;
    })
    .addTo(map);
}

// Route from input
function route(){
    if(!destination.value) return alert("Enter destination");
    fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(destination.value)}`)
    .then(r=>r.json()).then(d=>{
        if(!d.length) return alert("Not found");
        routeFromTo(userLoc,[+d[0].lat,+d[0].lon]);
    });
}

// Save trip (max 6)
function saveTrip(){
    const dest=destination.value.trim();
    if(!dest) return alert("Enter destination");
    let trips=JSON.parse(localStorage.getItem("trips")||"[]");
    if(trips.includes(dest)) return alert("Already saved");
    if(trips.length>=6) return alert("Max 6 trips allowed");
    trips.push(dest);
    localStorage.setItem("trips",JSON.stringify(trips));
    loadTrips();
}

// Load & delete trips
function loadTrips(){
    let trips=JSON.parse(localStorage.getItem("trips")||"[]");
    tripList.innerHTML="";
    trips.forEach((t,i)=>{
        let li=document.createElement("li");
        li.innerHTML=`<span style="cursor:pointer">ğŸ“ ${t}</span> <span style="cursor:pointer">âŒ</span>`;
        li.children[0].onclick=()=>routeFromSaved(t);
        li.children[1].onclick=()=>deleteTrip(i);
        tripList.appendChild(li);
    });
}
function deleteTrip(i){
    let trips=JSON.parse(localStorage.getItem("trips")||"[]");
    trips.splice(i,1);
    localStorage.setItem("trips",JSON.stringify(trips));
    loadTrips();
}
function routeFromSaved(t){
    fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t)}`)
    .then(r=>r.json()).then(d=>{
        routeFromTo(userLoc,[+d[0].lat,+d[0].lon]);
    });
}

// Nearest fuel
function findFuel(){
    fetch(`https://overpass-api.de/api/interpreter?data=[out:json];node(around:5000,${userLoc[0]},${userLoc[1]})[amenity=fuel];out;`)
    .then(r=>r.json()).then(d=>{
        let nearest=d.elements[0],min=Infinity;
        d.elements.forEach(p=>{
            let dist=map.distance(userLoc,[p.lat,p.lon]);
            if(dist<min){min=dist;nearest=p;}
        });
        L.marker([nearest.lat,nearest.lon]).addTo(map)
        .bindPopup(`â›½ Nearest fuel ${(min/1000).toFixed(2)} km`).openPopup();
    });
}

// Mileage
function calcMileage(){
    let f=+fuel.value,d=+distance.value;
    if(!f||!d) return;
    mileageResult.innerText=`Mileage: ${(d/f).toFixed(2)} km/l`;
}

// Service
function checkService(){
    let l=+lastService.value,c=+currentKm.value;
    serviceResult.innerText=(c-l)>=3000?"âš ï¸ Service Due":"âœ… Service OK";
}

// RTO
function openRTO(){
    if(!vehicleNo.value) return alert("Enter vehicle number");
    window.open("https://vahan.parivahan.gov.in","_blank");
}

// Theme
function toggleTheme(){
    document.body.classList.toggle("light-mode");
}
</script>

</body>
</html>
